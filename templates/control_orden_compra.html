{% extends "base.html" %}
{% block title %}Control Órdenes de Compra{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1>Órdenes de Compra</h1>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Cliente</th>
        <th># Orden</th>
        <th># Cotización</th>
        <th>Fecha</th>
        <th>Monto</th>
        <th>Moneda</th>
        <th>Estado</th>
        <th>Solicitante</th>
        <th>Tiempo (dias)</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="oc-lista"></tbody>
  </table>
  <div class="text-center">
    <button id="btn-ver-mas-oc" class="btn btn-primary">Ver más</button>
  </div>
</div>

<!-- Detalle OC Modal -->
<div class="modal fade" id="detalleOCModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalle Orden de Compra</h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Observaciones -->
        <p><strong>Observaciones:</strong> <span id="detalle-observaciones"></span></p>
        <!-- Tabla Productos -->
        <table class="table table-sm table-bordered">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant. Ordenada</th>
              <th>Cant. Recibida</th>
              <th>Por Recibir</th>
              <th>Precio Unit.</th>
              <th>Total</th>
              <th>Cant. a Incluir</th>
            </tr>
          </thead>
          <tbody id="productos-orden-compra-lista"></tbody>
        </table>

        <!-- Generar nueva Guía -->
        <div class="form-inline mb-3">
          <input type="text" id="numeroGuiaCompra" class="form-control mr-2" placeholder="Número de Guía">
          <button class="btn btn-success" onclick="generarGuiaCompra()">Generar Guía</button>
        </div>

        <!-- Guías existentes -->
        <h6>Guías de Remisión Existentes</h6>
        <table class="table table-sm table-bordered">
          <thead>
            <tr>
              <th># Guía</th>
              <th>Fecha</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="guias-compra-lista"></tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Detalle Guía Modal -->
<div class="modal fade" id="detalleGCModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalles Guía de Remisión</h5>
        <button type="button" class="close" onclick="volverDetalleOC()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Estado:</label>
          <select id="gc-estado" class="form-control">
            <option>Pendiente</option>
            <option>Emitida</option>
            <option>Cerrada</option>
          </select>
        </div>
        <div class="form-group">
          <label>Comentario:</label>
          <textarea id="gc-comentario" class="form-control"></textarea>
        </div>
        <h6>Productos</h6>
        <table class="table table-sm table-bordered">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant. Ordenada</th>
              <th>Cant. Recibida</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody id="gc-productos-lista"></tbody>
        </table>
        <button class="btn btn-primary" onclick="guardarCambiosGC()">Guardar Cambios</button>
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">
  Cancelar
</button>
        <button type="button" class="close" onclick="volverDetalleOC()">&times;</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='control_orden_compra.js') }}"></script>
{% endblock %}